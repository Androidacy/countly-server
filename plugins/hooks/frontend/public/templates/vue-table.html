<cly-section>
    <cly-datatable-n
        :force-loading="!initialized"
        class="cly-vue-hook-table is-clickable"
        :tracked-fields="localTableTrackedFields"
        :rows="tableRows" :resizable="false"
        :available-dynamic-cols="tableDynamicCols" >
        <template v-slot:header-left="scope">
            <div class="bu-mr-2">
                <el-radio-group :plain="true" v-model="filterStatus">
                    <el-radio-button label="all">{{i18n('hooks.status-all')}}</el-radio-button>
                    <el-radio-button label="enabled">{{i18n('hooks.status-enabled')}}</el-radio-button>
                    <el-radio-button label="disabled">{{i18n('hooks.status-disabled')}}</el-radio-button> 
                </el-radio-group>
            </div>
            <div>
                <cly-select-x
                   :placeholder="i18n('hooks.all-applications')"
                   mode="multi-check"
                   v-model="filteredApps"
                   :options="appsSelectorOption">
                </cly-select-x>
            </div>
        </template>

        <template v-slot="scope">
            <el-table-column fixed="left" width="88" label="">
                <template v-slot="rowScope">
                    <el-switch :value="rowScope.row.enabled"
                        class="bu-ml-4  bu-mr-2" 
                        @input="scope.patch(rowScope.row, {enabled: !rowScope.row.enabled})">
                    </el-switch>
                </template>
            </el-table-column>
           
            <el-table-column fixed :label="i18n('hooks.hook-name')" sortable="true"  min-width="280" :class="is-clickable">
                <template slot-scope="scope">
                    <div>
                        <div class="is-name-col bu-is-clickable" @click="onRowClick(scope.row)" >{{scope.row.name}}</div>
                        <div class="is-desc-col">{{scope.row.description}}</div>
                    </div>
                </template>
            </el-table-column> 

            <el-table-column  :label="(i18n('hooks.trigger') + ' -> '+ i18n('hooks.effects'))" sortable="true" min-width="280" >
            <template slot-scope="scope" sortable="true">
                <div v-html="scope.row.triggerEffectColumn"></div>
            </template>
                
            </el-table-column>
            <template v-for="(col,idx) in scope.dynamicCols">
                <el-table-column 
                    v-if="col.value === 'triggerCount'"  
                    sortable="true" align="right" prop="triggerCount" :label="i18n('hooks.trigger-count')" width="170">
                </el-table-column>
                <el-table-column
                    v-if="col.value === 'lastTriggerTimestampString'"  
                    sortable="true"  prop="lastTriggerTimestampString" :label="i18n('hooks.trigger-last-time')" width="180" >
                </el-table-column>
            </template>


            <el-table-column :label="i18n('hooks.create-by')" width="210" sortable="true">
                <template slot-scope="scope">
                    <div class="is-last-col">
                        <div >
                            <div class="is-created-by-col">
                                {{scope.row.createdByUser}}
                             </div>
                             <div class="is-created-by-desc-col">
                                 {{ scope.row.created_at_string }}
                             </div>
                        </div> 
                    </div>
                </template>
            </el-table-column>
            <el-table-column type="options">
                <template v-slot="rowScope">
                    <cly-more-options v-if="rowScope.row.hover" size="small" @command="handleHookEditCommand($event,rowScope)">
                        <el-dropdown-item icon="el-icon-document-copy" command="edit-comment">
                            {{i18n('hooks.edit')}}
                        </el-dropdown-item>
                        <el-dropdown-item icon="el-icon-delete" command="delete-comment">
                            {{i18n('hooks.delete')}}
                        </el-dropdown-item>
                    </cly-more-options>
                </template>
            </el-table-column>
        </template>
        <template v-slot:bottomline="scope">
            <cly-diff-helper :diff="scope.diff" @discard="scope.unpatch()" @save="updateStatus(scope)">
            </cly-diff-helper>
        </template>
    </cly-datatable-n>
    <cly-confirm-dialog 
        @cancel="closeDeleteForm" 
        @confirm="submitDeleteForm" 
        :before-close="closeDeleteForm" 
        ref="deleteConfirmDialog" 
        :visible.sync="showDeleteDialog" 
        dialogType="danger" 
        :saveButtonLabel="i18n('common.delete')" 
        :cancelButtonLabel="i18n('common.no-dont-delete')" 
        :title="i18n('hooks.delete-confirm-title')" >
            <template slot-scope="scope">
                <div v-html="deleteMessage"></div>
            </template>
    </cly-confirm-dialog>
</cly-section>
