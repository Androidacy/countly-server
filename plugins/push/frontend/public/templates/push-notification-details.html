<script type="text/x-template" id="push-notification-details">
    <div v-bind:class="[componentId]">
        <cly-header class="cly-vue-push-notification-details-header">
            <template v-slot:header-left>
                <h2> {{pushNotification.name }} </h2>
            </template>
            <template v-slot:header-top>
                <cly-back-link link="/messaging" :title="i18n('push-notification-details.back-to')"></cly-back-link>
            </template>
            <template v-slot:header-right>
                <template v-if="pushNotification.status === StatusEnum.PENDING_APPROVAL && hasApproverPermission">
                    <el-button @click="onReject(pushNotification._id)" class="bu-mr-2"> <i class="ion-close-circled" ></i> {{i18n('push-notification.reject')}} </el-button>
                    <el-button @click="onApprove(pushNotification._id)" class="bu-mr-2 bu-ml-0"> <i class="ion-checkmark-circled" ></i> {{i18n('push-notification.approve')}} </el-button>
                </template>
                <cly-more-options size="small" @command="handleUserCommands($event, pushNotification._id)">
                    <el-dropdown-item v-if="shouldShowDuplicateUserCommand(pushNotification.status)" :command="UserCommandEnum.DUPLICATE">{{i18n('push-notification.duplicate')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowDeleteUserCommand(pushNotification.status)"  :command="UserCommandEnum.DELETE">{{i18n('push-notification.delete')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowResendUserCommand(pushNotification.status)" :command="UserCommandEnum.RESEND">{{i18n('push-notification.resend')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowEditDraftUserCommand(pushNotification.status)" :command="UserCommandEnum.EDIT_DRAFT">{{i18n('push-notification.edit-draft')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowEditUserCommand(pushNotification.status)" :command="UserCommandEnum.EDIT">{{i18n('push-notification.edit')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowEditRejectUserCommand(pushNotification.status)" :command="UserCommandEnum.EDIT_REJECT">{{i18n('push-notification.edit')}}</el-dropdown-item>
                </cly-more-options>
            </template>
            <template v-slot:header-bottom>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <cly-status-tag :text="statusOptions[pushNotification.status] && statusOptions[pushNotification.status].label || '' " :color="getStatusBackgroundColor(pushNotification.status)"> </cly-status-tag>
                </div>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <div class="ion ion-ios-time-outline cly-vue-push-notification-details-sub-header-icon"></div>
                    <span class="cly-vue-push-notification-details-sub-header-title"> {{i18n('push-notification-details.created-by',pushNotification.createdDateTime && formatTimeAgoText(pushNotification.createdDateTime.date),pushNotification.createdBy)}}</span>
                </div>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <div class="ion ion-pricetag cly-vue-push-notification-details-sub-header-icon"></div>
                    <span class="cly-vue-push-notification-details-sub-header-title"> {{i18n('push-notification-details.message-id')}} {{pushNotification._id}} </span>
                </div>
            </template>
        </cly-header>
        <cly-main>
            <div>
                <div class="bu-level-left" style="margin-bottom:32px">
                    <div class="bu-level-item">
                        <div class="cly-vue-platform-filter-label"> 
                            {{i18n('push-notification-details.results-for')}}
                        </div>
                    </div>
                    <div class="bu-level-item">
                        <el-select v-model="selectedPlatformFilter">
                            <el-option v-for="item in platformFilters" :key="item.value" :value="item.value" :label="item.label"></el-option>
                        </el-select>
                    </div>
                    <div class="bu-level-item">
                        <div class="cly-vue-platform-filter-label"> 
                            {{i18n('push-notification-details.and-label')}}
                        </div>
                    </div>
                    <div class="bu-level-item">
                        <el-select v-model="selectedLocaleFilter">
                            <el-option v-for="item in localizations" :key="item.value" :value="item.value" :label="item.label"></el-option>
                        </el-select>
                    </div>
                </div>
            </div>
            <cly-section>
                <div class="bu-is-flex cly-vue-push-notification-details-chart-bars">
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right">
                        <cly-chart-bar :option="pushNotificationChartBars.targetedUsers" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> {{i18n('push-notification.users-targeted')}}  <cly-tooltip-icon :tooltip="i18n('push-notification.users-targeted-description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{targetedUsers}} % </div>
                                <div class="text-medium"> {{selectedDashboard.processed || 0}} {{i18n('push-notification.users')}}  </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right"> 
                        <cly-chart-bar :option="pushNotificationChartBars.sentPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> {{i18n('push-notification.sent-notifications')}}  <cly-tooltip-icon :tooltip="i18n('push-notification.sent-notifications-description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{sentPushNotifications}} % </div>
                                <div class="text-medium"> {{selectedDashboard.sent || 0}} {{i18n('push-notification.users')}}  </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right"> 
                        <cly-chart-bar :option="pushNotificationChartBars.clickedPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> {{i18n('push-notification.clicked-notifications')}} <cly-tooltip-icon :tooltip="i18n('push-notification.clicked-notifications-description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{clickedPushNotifications}} % </div>
                                <div class="text-medium"> {{selectedDashboard.actioned || 0}} {{i18n('push-notification.users')}} </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item"> 
                        <cly-chart-bar :option="pushNotificationChartBars.failedPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> {{i18n('push-notification.failed')}} <cly-tooltip-icon :tooltip="i18n('push-notification.failed-description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{failedPushNotifications}} % </div>
                                <div class="text-medium"> {{selectedDashboard.errored || 0}} {{i18n('push-notification.users')}} </div>
                            </div>
                        </div>
                    </div>
                </div>
            </cly-section>
            <div class="cly-vue-push-notification-details-summary">
                <div class="bu-columns">
                    <div class="bu-column bu-is-10">
                        <cly-header class="cly-vue-push-notification-details-summary__header">
                            <template v-slot:header-left>
                                <h2> {{i18n('push-notification-details.summary-header')}} </h2>
                                <cly-tooltip-icon :tooltip="i18n('push-notification-details.summary-header-descriptionn')" icon="ion ion-help-circled" style="margin-left:8px"> </cly-tooltip-icon>
                            </template>
                            <template v-slot:header-tabs>
                                <cly-dynamic-tabs v-model="currentSummaryTab" skin="secondary" :tabs="summaryTabs"></cly-dynamic-tabs>
                            </template>
                        </cly-header>
                    </div>
                    <div class="bu-column">
                        <mobile-message-preview :title="message.title" :content="message.content" :platforms="pushNotification.platforms" :media="previewMessageMedia" :buttons="message.buttons.map(function(item){return item.label})" class="cly-vue-push-notification-details-summary__message-preview"> </mobile-message-preview>
                    </div>
                </div>
            </div>
        </cly-main>
        <push-notification-drawer @onClose="onDrawerClose" :controls="drawers.pushNotificationDrawer" :type="pushNotification.type" :userCommand="userCommand.type" :id="userCommand.pushNotificationId" :isOpened="isDrawerOpen"></push-notification-drawer>
    </div>
</script>
